FIXING FIRESTORE ERRORS
=======================

If you're seeing "Fetch API cannot load" errors for Firestore, you need to:

1. CREATE FIRESTORE DATABASE
------------------------------

Go to: https://console.firebase.google.com/project/passion-project-2eb1c/firestore

- Click "Create database" if you see it
- Select "Start in test mode" (for development)
- Choose a location closest to you
- Click "Enable"
- Wait for database to be created (1-2 minutes)

2. SET UP SECURITY RULES
-------------------------

Go to: https://console.firebase.google.com/project/passion-project-2eb1c/firestore/rules

For development/testing, use these rules:

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow read access to locations for everyone (public map)
    match /locations/{locationId} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.uid == resource.data.createdBy || 
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
    }
    
    // Pending locations - only authenticated users can read their own
    match /pendingLocations/{locationId} {
      allow read: if request.auth != null && 
        (request.auth.uid == resource.data.requestedBy || 
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Pending deletions - only admins can read/write
    match /pendingDeletions/{deletionId} {
      allow read, write: if request.auth != null && 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Users collection
    match /users/{userId} {
      allow read: if request.auth != null && (request.auth.uid == userId || 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
      allow create: if request.auth != null && request.auth.uid == userId;
      allow update: if request.auth != null && (request.auth.uid == userId || 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
    }
    
    // Fallback for other collections
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}

Click "Publish" to save the rules.

3. VERIFY FIREBASE CONFIG
--------------------------

Make sure your .env file has all Firebase config values:
- REACT_APP_FIREBASE_API_KEY
- REACT_APP_FIREBASE_AUTH_DOMAIN
- REACT_APP_FIREBASE_PROJECT_ID
- REACT_APP_FIREBASE_STORAGE_BUCKET
- REACT_APP_FIREBASE_MESSAGING_SENDER_ID
- REACT_APP_FIREBASE_APP_ID

4. RESTART DEV SERVER
----------------------

After making changes, restart your dev server:
- Stop the server (Ctrl+C)
- Run: npm start

The errors should disappear once the database is created and rules are set up.

